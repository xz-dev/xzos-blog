---
/**
 * è¯­è¨€ç‰ˆæœ¬æç¤ºç»„ä»¶
 * æ˜¾ç¤ºåœ¨åšå®¢æ–‡ç« é¡¶éƒ¨ï¼Œæç¤ºç”¨æˆ·å¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–è¯­è¨€ç‰ˆæœ¬
 * å¯¹äºç¿»è¯‘ç‰ˆæœ¬ï¼Œæ˜¾ç¤º LLM ç¿»è¯‘å£°æ˜
 */
import { languages, defaultLang, type Lang } from '../i18n/ui';
import { existsSync } from 'node:fs';
import { join } from 'node:path';

interface Props {
  /** å½“å‰æ–‡ç« çš„ slug (æ–‡ä»¶åï¼Œä¸å«æ‰©å±•å) */
  slug: string;
  /** å½“å‰è¯­è¨€ */
  lang?: Lang;
}

const { slug, lang = defaultLang } = Astro.props;

// æ£€æŸ¥å…¶ä»–è¯­è¨€ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨
const availableVersions: { lang: Lang; path: string; label: string }[] = [];

// æ£€æŸ¥åŸæ–‡ï¼ˆä¸­æ–‡ï¼‰
const zhPath = join(process.cwd(), 'src/content/blog', `${slug}.md`);
if (existsSync(zhPath) && lang !== 'zh') {
  availableVersions.push({
    lang: 'zh',
    path: `/blog/${slug}`,
    label: languages.zh,
  });
}

// æ£€æŸ¥è‹±æ–‡ç‰ˆæœ¬
const enPath = join(process.cwd(), 'src/content/blog/en', `${slug}.md`);
if (existsSync(enPath) && lang !== 'en') {
  availableVersions.push({
    lang: 'en',
    path: `/en/blog/${slug}`,
    label: languages.en,
  });
}

// æ£€æŸ¥ç®€ä¸­ç‰ˆæœ¬
const zhCNPath = join(process.cwd(), 'src/content/blog/zh-CN', `${slug}.md`);
if (existsSync(zhCNPath) && lang !== 'zh-CN') {
  availableVersions.push({
    lang: 'zh-CN',
    path: `/zh-CN/blog/${slug}`,
    label: languages['zh-CN'],
  });
}

// æ£€æŸ¥æ˜¯å¦ä¸ºç¿»è¯‘ç‰ˆæœ¬ï¼ˆè‹±æ–‡æˆ–ç®€ä¸­ï¼‰
const isTranslatedVersion = lang === 'en' || lang === 'zh-CN';
const originalVersionPath = lang === 'zh' ? null : `/blog/${slug}`;
---

{isTranslatedVersion && originalVersionPath && (
  <div class="translation-notice">
    <span class="notice-icon">ğŸ¤–</span>
    <span>
      {lang === 'en' 
        ? 'This article was translated by AI (LLM). There may be errors or inaccuracies. For the original content, please refer to the '
        : 'æœ¬æ–‡ç”± AIï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰ç¿»è¯‘ã€‚å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–ä¸å‡†ç¡®ä¹‹å¤„ã€‚å¦‚éœ€æŸ¥çœ‹åŸæ–‡ï¼Œè¯·å‚é˜…'
      }
      <a href={originalVersionPath} hreflang="zh">
        {lang === 'en' ? 'original version' : 'åŸæ–‡'}
      </a>ã€‚
    </span>
  </div>
)}

{availableVersions.length > 0 && (
  <div class="language-notice">
    <span class="notice-icon">ğŸŒ</span>
    <span>
      {lang === 'zh' ? 'This article is also available in:' : 'æœ¬æ–‡è¿˜æœ‰å…¶ä»–è¯­è¨€ç‰ˆæœ¬ï¼š'}
    </span>
    {availableVersions.map((version, index) => (
      <>
        <a href={version.path} hreflang={version.lang}>
          {version.label}
        </a>
        {index < availableVersions.length - 1 && <span> / </span>}
      </>
    ))}
  </div>
)}

<style>
  .language-notice,
  .translation-notice {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    margin-bottom: 1.5rem;
    background: var(--card-background, rgba(var(--gray-light), 0.3));
    border-radius: 8px;
    border-left: 4px solid rgb(var(--accent));
    font-size: 0.9rem;
  }
  
  .translation-notice {
    border-left-color: #f59e0b;
    background: rgba(245, 158, 11, 0.1);
  }
  
  .notice-icon {
    font-size: 1.1rem;
    flex-shrink: 0;
  }
  
  .language-notice a,
  .translation-notice a {
    color: rgb(var(--accent));
    font-weight: 600;
    text-decoration: none;
  }
  
  .language-notice a:hover,
  .translation-notice a:hover {
    text-decoration: underline;
  }
</style>
