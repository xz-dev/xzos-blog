---
/**
 * è¯­è¨€ç‰ˆæœ¬æç¤ºç»„ä»¶
 * æ˜¾ç¤ºåœ¨åšå®¢æ–‡ç« é¡¶éƒ¨ï¼Œæç¤ºç”¨æˆ·å¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–è¯­è¨€ç‰ˆæœ¬
 */
import { languages, defaultLang, type Lang } from '../i18n/ui';
import { existsSync } from 'node:fs';
import { join } from 'node:path';

interface Props {
  /** å½“å‰æ–‡ç« çš„ slug (æ–‡ä»¶åï¼Œä¸å«æ‰©å±•å) */
  slug: string;
  /** å½“å‰è¯­è¨€ */
  lang?: Lang;
}

const { slug, lang = defaultLang } = Astro.props;

// æ£€æŸ¥å…¶ä»–è¯­è¨€ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨
const otherLang: Lang = lang === 'zh' ? 'en' : 'zh';
const otherLangLabel = languages[otherLang];

// æ„å»ºå…¶ä»–è¯­è¨€ç‰ˆæœ¬çš„è·¯å¾„
let otherVersionPath: string;
let otherVersionExists = false;

if (lang === 'zh') {
  // å½“å‰æ˜¯ä¸­æ–‡ï¼Œæ£€æŸ¥è‹±æ–‡ç‰ˆæœ¬
  const enPath = join(process.cwd(), 'src/content/blog/en', `${slug}.md`);
  otherVersionExists = existsSync(enPath);
  otherVersionPath = `/en/blog/${slug}`;
} else {
  // å½“å‰æ˜¯è‹±æ–‡ï¼Œæ£€æŸ¥ä¸­æ–‡ç‰ˆæœ¬
  const zhPath = join(process.cwd(), 'src/content/blog', `${slug}.md`);
  otherVersionExists = existsSync(zhPath);
  otherVersionPath = `/blog/${slug}`;
}

const noticeText = lang === 'zh' 
  ? `This article is also available in ${otherLangLabel}`
  : `æœ¬æ–‡ä¹Ÿæœ‰${otherLangLabel}ç‰ˆæœ¬`;
---

{otherVersionExists && (
  <div class="language-notice">
    <span class="notice-icon">ğŸŒ</span>
    <span>{noticeText}:</span>
    <a href={otherVersionPath} hreflang={otherLang}>
      {otherLangLabel}
    </a>
  </div>
)}

<style>
  .language-notice {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    margin-bottom: 1.5rem;
    background: var(--card-background, rgba(var(--gray-light), 0.3));
    border-radius: 8px;
    border-left: 4px solid rgb(var(--accent));
    font-size: 0.9rem;
  }
  
  .notice-icon {
    font-size: 1.1rem;
  }
  
  .language-notice a {
    color: rgb(var(--accent));
    font-weight: 600;
    text-decoration: none;
  }
  
  .language-notice a:hover {
    text-decoration: underline;
  }
</style>
